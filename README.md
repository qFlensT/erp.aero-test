# Тестовое задание для erp.aero
## Архитектура проекта
Выбранная архитектура проекта - немного видоизмененная `Clean Architecture`

Типичная Clean Architecture, которая состоит из:
- `domain` слоя (бизнес-сущности (entities) и юзкейсы бизнеса (services));
- `infrastructure`, внешние сервисы;
- `adapters`, адаптеры ко внешним сервисам из слоя `infrastructure` (например ORM) к `domain` слою, в который они инджектируются;
- слоя `presentation` (контроллеры).

### domain
#### abstract
Тут лежат все интерфейсы необходимые для работы use-case'ов

#### entities
Бизнес-сущности

#### services
Сами use-case'ы, в которых могут содержаться кастомные ошибки, типы и т.д.

### adapters
Тут распологаются все адаптеры внешних сервисов к `domain` слою

### infrastructure
Внешние сервисы: ORM, S3, Redis...

### presentation
#### controllers
HTTP контроллеры

#### dto
DTO

#### filters
Фильтры приложения, сейчас тут содержится только фильтр ошибок, который преобразует `DomainError` из `domain` слоя в `HTTP` ошибки для этого слоя

#### guards
Гуарды для защиты запросов, сейчас включают в себя:
- auth.guard
- no-auth.guard

#### mapping
Мапперы, которые преобразуют ошибки и сущности в `HTTP` ошибки и `DTO` соответственно

#### schemas
Схемы валидации данных

## Что можно было сделать лучше?
- добавить версионирование API;
- добавить ошибки для инджектируемых сервисов в domain, тогда можно было более точно формировать `domain` ошибки и соответственно возвращать `HTTP` ошибки в `presentation`;
- добавить время удаления отозванных токенов из кэша равное времени жизни этих токенов;
- перенести в комплексную логику из контроллеров в дополнительный слой `domain`, который мог бы импортировать в себя разные сервисы;
- добавить логирование;
- вынести логику из `adapters` в `infrastructure`;
- добавить защиту от `CSFR`;
- добавить лимит на загружаемый файл;

### FAQ
#### Почему для отзыва токенов используется именно кэш?
Так как сами по себе `JWT` токены `statefull` не имеет смысл хранить их еще и в БД, так как теряется одно из их преимуществ (но не единственное): скорость проверки. Если подключить `Redis` к проекту через слой `adapters` и `infrastructure`, то кэш будет безопасно там хранится.
